<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>26Â°C æº«åº¦èª¿æ ¡å„€ - çµ±ä¸€ç°è—è«è˜­è¿ªç‰ˆ</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- è«è˜­è¿ªè‰²èª¿å®šç¾© (Morandi Palette) --- */
        :root {
            /* ç”¨æˆ¶æŒ‡å®šé¡è‰² */
            --color-bg-body: #E0D9D3;        /* ä¸»èƒŒæ™¯è‰² (æ·ºç°è¤è‰²) */
            --color-block-bg: #F6F5F3;       /* å€å¡ŠèƒŒæ™¯è‰² (æ¥è¿‘ç´™ç™½) */
            
            /* æŒ‰éˆ•/å¼·èª¿è‰²ç³» (ä»¥æŒ‰éˆ•è‰² #7D8A92 ç‚ºä¸») */
            --color-accent-gray: #505B63;    /* è¼”åŠ©æ·±ç°è— - ç¾ç‚ºä¸»è¦æ–‡å­—é¡è‰² (å¾ #7D8A92 åŠ æ·±) */
            --color-text-primary: var(--color-accent-gray); /* ä¸»è¦æ–‡å­—é¡è‰²ï¼Œèˆ‡æŒ‰éˆ•è‰²çµ±ä¸€ */
            
            /* è¼”åŠ©å’ŒæŒ‡ç¤ºè‰² */
            --color-comfort-green: #A3B8A8;  /* æŸ”å’Œæ·¡ç°ç¶  - èˆ’é©å€/é¸ä¸­é … (ä¿ç•™ç‚ºæç¤ºè‰²) */
            --color-warm: #D1A5A5;           /* ç«ç‘°ç° - éç†±è­¦ç¤º */
            --color-cool: #A2B2C2;           /* æ¿å²©ç°è— - éå†·è­¦ç¤º */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-body);
            color: var(--color-text-primary); /* ä¸»é«”æ–‡å­—ä½¿ç”¨æ–°çš„æ·±ç°è—è‰² */
            min-height: 10vh;
        }
        /* å¡ç‰‡/å€å¡Šæ¨£å¼ - æ‰€æœ‰å€å¡Šä½¿ç”¨ç›¸åŒçš„æ˜äº®èƒŒæ™¯ */
        .card {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* è¼•å¾®é™°å½±å€éš” */
            border-radius: 1rem;
            padding: 1.5rem;
            transition: background-color 0.3s ease; 
            background-color: var(--color-block-bg); /* çµ±ä¸€å€å¡ŠèƒŒæ™¯è‰² */
            color: var(--color-text-primary); /* å€å¡Šå…§æ–‡å­—çµ±ä¸€é¡è‰² */
        }
        .card h3, .card h2 {
            color: var(--color-text-primary); /* ç¢ºä¿æ¨™é¡Œé¡è‰²ä¸€è‡´ */
        }
        /* é é¦–æ–‡å­—é¡è‰²èª¿æ•´ */
        header h1, header p {
            color: var(--color-text-primary);
        }

        /* æ ¸å¿ƒæº«åº¦è¨ˆæ¨£å¼ - æ©«å‘ä½ˆå±€èª¿æ•´ */
        #calibrator-track {
            height: 16px; 
            width: 100%; 
            background-color: #E0E0E0;
            border-radius: 8px;
            position: relative;
        }
        .comfort-zone {
            position: absolute;
            background-color: var(--color-comfort-green);
            opacity: 0.8; 
            height: 100%; 
            border-radius: 4px;
            left: 83.333%; 
            width: 6.667%;
        }
        /* æœ€çµ‚é«”æ„Ÿæº«åº¦æŒ‡ç¤ºå™¨ - ä½¿ç”¨è«è˜­è¿ªè‰² */
        #calibrator-indicator {
            position: absolute;
            top: 50%; 
            transform: translateY(-50%) translateX(-50%); 
            width: 24px;
            height: 24px;
            border-radius: 50%;
            transition: all 0.8s ease-out;
            border: 3px solid white;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.2); 
        }
        /* æˆ¶å¤–é«”æ„Ÿæº«åº¦æŒ‡ç¤ºç·š */
        #outdoor-indicator {
            position: absolute;
            top: 0;
            height: 100%;
            width: 2px; 
            background-color: var(--color-accent-gray); 
            transition: left 0.8s ease-out;
        }
        .input-box {
            border: 1px solid #C0C0C0; 
            background-color: white; 
            color: var(--color-text-primary);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 1.125rem;
            text-align: center;
        }

        /* å»ºè­°å¡ç‰‡æ¨£å¼ - è«è˜­è¿ª info æ¨£å¼ */
        .advice-card-info {
            background-color: var(--color-block-bg); /* èˆ‡ä¸»å€å¡ŠèƒŒæ™¯ä¸€è‡´ */
            border-left: 4px solid var(--color-cool); 
        }

        /* ç©¿æ­æŒ‰éˆ•é è¨­èƒŒæ™¯ç‚ºç™½è‰²ï¼Œé¸ä¸­æ™‚è®Šç‚ºèˆ’é©ç¶  */
        .outfit-btn {
            background-color: white; 
            color: var(--color-text-primary);
        }
        .outfit-btn.selected-item {
            background-color: var(--color-comfort-green) !important;
            color: white !important;
        }
        
        /* é‡å°æ‰‹æ©Ÿå„ªåŒ– */
        @media (max-width: 639px) {
            .card {
                padding: 1rem; 
            }
        }
    </style>
</head>
<body class="flex flex-col items-center p-4 sm:p-8">

    <header class="text-center mb-6 sm:mb-8">
        <h1 class="text-2xl sm:text-4xl font-bold">26Â°C æº«åº¦èª¿æ ¡å„€</h1>
        <!-- 26Â°C æº«åº¦ç¾åœ¨æœƒç¹¼æ‰¿ body çš„é¡è‰²ï¼Œå³æ–°çš„æ·±ç°è—è‰² -->
        <p class="text-sm sm:text-base mt-1">ç›®æ¨™é«”æ„Ÿèˆ’é©æº«åº¦ï¼š<span class="font-semibold">26Â°C</span></p>
    </header>

    <main class="w-full max-w-4xl space-y-4 sm:space-y-6">

        <!-- å€å¡Š 1: æˆ¶å¤–é«”æ„Ÿæº«åº¦è¼¸å…¥å€ (èƒŒæ™¯è‰²: çµ±ä¸€çš„æ·ºè‰²è«è˜­è¿ª) -->
        <section class="card">
            <h3 class="text-lg sm:text-xl font-semibold mb-4">1. æˆ¶å¤–èµ·å§‹æº«åº¦è¼¸å…¥ (T_æˆ¶å¤–)</h3>
            <div class="flex justify-center">
                
                <div class="w-full max-w-xs">
                    <label for="input-outdoor-temp" class="text-base sm:text-lg font-medium block mb-2 text-center">
                        ç•¶å‰ç’°å¢ƒé«”æ„Ÿæº«åº¦
                    </label>
                    <input type="number" id="input-outdoor-temp" min="-10" max="40" step="0.5" value="" placeholder="è«‹è¼¸å…¥Â°C" class="input-box w-full mx-auto block" oninput="updateTemperatureCalibrator()">
                    <p class="text-xs text-gray-500 mt-1 text-center" style="color: #ADADAD;">å–®ä½ï¼šÂ°C (è«‹è¼¸å…¥æ‚¨ç•¶ä¸‹çš„é«”æ„Ÿæº«åº¦æˆ–æ°£æº«)</p>
                </div>
            </div>

            <!-- è¨ˆç®—çµæœé¡¯ç¤º -->
            <div class="text-lg sm:text-xl font-extrabold border-t pt-4 mt-4 w-full text-center">
                <p class="text-sm font-light mb-1" style="color: #ADADAD;">æˆ¶å¤–èµ·å§‹æº«åº¦ (T_æˆ¶å¤–)</p>
                <span id="adjusted-temp-info" class="text-3xl sm:text-4xl">--Â°C</span>
                <span id="needed-score-info" class="text-sm font-light block" style="color: #ADADAD;">éœ€è¦æº«æš–é»æ•¸: --Â°C</span>
            </div>
        </section>

        <!-- å€å¡Š 2: æ ¸å¿ƒæº«åº¦èª¿æ ¡å„€èˆ‡çµæœ (èƒŒæ™¯è‰²: çµ±ä¸€çš„æ·ºè‰²è«è˜­è¿ª) -->
        <section class="card flex flex-col lg:flex-row justify-between items-start space-y-6 lg:space-y-0 lg:space-x-8">
            
            <!-- å·¦å´ï¼šèª¿æ ¡å„€è¦–è¦ºåŒ–ã€æŒ‰éˆ•å’Œæ¨è–¦æ¸…å–® -->
            <div class="w-full lg:w-1/3 flex flex-col items-center justify-center">
                <!-- æ°´å¹³æŒ‡æ¨™æ¢å®¹å™¨ -->
                <div id="calibrator-container" class="relative w-full h-16 mb-8 pt-4"> 
                    <!-- 26C ç›®æ¨™ç·š -->
                    <div class="absolute top-0 w-px h-full" style="left: 86.667%; z-index: 10; background-color: var(--color-accent-gray);"></div> 
                    <span class="absolute -top-6 text-xs font-semibold" style="left: 86.667%; transform: translateX(-50%); color: var(--color-accent-gray);">26Â°C (ç›®æ¨™)</span>
                    
                    <!-- æº«åº¦è»Œé“ -->
                    <div id="calibrator-track" class="absolute bottom-0">
                        <!-- èˆ’é©å€æ¨™ç¤º -->
                        <div class="comfort-zone"></div>
                        
                        <!-- æˆ¶å¤–é«”æ„Ÿæº«åº¦æŒ‡ç¤ºç·š (T_æˆ¶å¤–) -->
                        <div id="outdoor-indicator" style="z-index: 5;"></div>
                        
                        <!-- é«”æ„ŸæŒ‡ç¤ºå™¨ (æœ€çµ‚é«”æ„Ÿ T_é«”æ„Ÿ) -->
                        <div id="calibrator-indicator" class="bg-gray-700" style="z-index: 20;"></div>
                    </div>
                </div>

                <!-- çµæœèˆ‡æŒ‰éˆ• -->
                <div class="text-center mt-4 w-full">
                    <h2 id="result-status" class="text-xl font-bold">è¨ˆç®—ä¸­...</h2>
                    <p id="result-message" class="mt-1">è«‹è¼¸å…¥æº«åº¦ä¸¦é»æ“Šä¸‹æ–¹æŒ‰éˆ•é€²è¡Œæ¨è–¦ã€‚</p>
                </div>
                
                <!-- æ¨è–¦æŒ‰éˆ• - ä½¿ç”¨è«è˜­è¿ªç°è—è‰² (èˆ‡æ–‡å­—åŒè‰²ç³») -->
                <button id="recommend-button" class="mt-4 w-full max-w-xs text-white font-bold py-2.5 px-5 rounded-xl transition duration-150 shadow-lg shadow-gray-400" style="background-color: var(--color-accent-gray); hover:background-color: #414a51;">
                    âœ¨ æ¨è–¦æœ€é©åˆç©¿æ­
                </button>
                
                <!-- æ¨è–¦æ¸…å–®é¡¯ç¤ºå€ -->
                <div id="final-recommendation-list" class="pt-4 mt-4 w-full hidden">
                     <!-- List will be populated here by JS -->
                </div>
            </div>

            <!-- å³å´ï¼šç©¿æ­é»æ•¸é¸æ“‡å™¨ -->
            <div class="w-full lg:w-2/3 space-y-4">
                <h3 class="text-lg sm:text-xl font-semibold mb-2">2. é¸æ“‡æ‚¨çš„å–®å“ (åŠ æº«é»æ•¸ Â°C)</h3>
                
                <!-- èª¿æ•´ç‚º 3 æ¬„ä½ˆå±€ä»¥é©æ‡‰æ›´å¤šé …ç›®ï¼Œä¸¦åˆ†å±¤é¡¯ç¤º -->
                <div id="outfit-selector" class="grid grid-cols-3 gap-2 sm:gap-3">
                    <!-- é …ç›®å°‡ç”± JS æ¸²æŸ“ -->
                </div>

                <div class="border-t pt-4 mt-4 flex justify-between items-center">
                    <p class="text-lg font-medium">ç©¿æ­ç¸½é»æ•¸ (T_é»æ•¸):</p>
                    <p id="total-score" class="text-3xl font-extrabold">0.0Â°C</p>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <p class="text-lg font-medium">æœ€çµ‚é«”æ„Ÿæº«åº¦ (T_é«”æ„Ÿ):</p>
                    <p id="current-body-temp" class="text-3xl font-extrabold">--Â°C</p>
                </div>

            </div>
        </section>

        <!-- å€å¡Š 3: è¡Œå‹•å°å‘å»ºè­°å¡ç‰‡ (ä½¿ç”¨è«è˜­è¿ª info æ¨£å¼) -->
        <section id="action-advice-card" class="card p-4 sm:p-6 hidden advice-card-info">
            <h3 class="text-lg sm:text-xl font-semibold">ğŸ’¡ ç©¿æ­å»ºè­°</h3>
            <p id="action-advice-text" class="mt-2 text-sm sm:text-base"></p>
        </section>
    </main>

    <script>
        // --- æ ¸å¿ƒæ•¸æ“šæ¨¡å‹ ---
        const OUTFIT_ITEMS = [
            // å…§è¡£ (Innerwear) - å¯å¤šé¸
            { category: 'å…§è¡£', name: 'ç™¼ç†±è¡£', score: 4.0, icon: 'ğŸ”¥' }, 
            { category: 'å…§è¡£', name: 'åˆ·æ¯›èƒŒå¿ƒ', score: 3.0, icon: 'ğŸ½' }, 
            
            // ä¸Šè¡£ (Top / Mid-layers) - å¯å¤šé¸ (å°æ‡‰ä½¿ç”¨è€…çš„ã€Œè¡£æœã€é¡åˆ¥)
            { category: 'ä¸Šè¡£', name: 'è–„æ£‰T', score: 1.0, icon: 'ğŸ‘š' },
            { category: 'ä¸Šè¡£', name: 'å¤§å­¸T / åšTæ¤', score: 2.5, icon: 'ğŸ‘•' },
            { category: 'ä¸Šè¡£', name: 'è–„é‡ç¹”', score: 3.0, icon: 'ğŸ§¶' }, 
            { category: 'ä¸Šè¡£', name: 'åšé‡ç¹”', score: 5.0, icon: 'ğŸ§£' }, 
            
            // è¤²å­ (Bottoms) - åš´æ ¼å–®é¸
            { category: 'è¤²å­', name: 'ç‰›ä»”è¤²', score: 2.0, icon: 'ğŸ‘–' },
            { category: 'è¤²å­', name: 'æ£‰è¤²', score: 2.5, icon: 'æ£‰' },
            { category: 'è¤²å­', name: 'åˆ·æ¯›è¤²', score: 4.5, icon: 'ğŸ‘–' },
            { category: 'è¤²å­', name: 'é•·è£™', score: 1.5, icon: 'ğŸ‘—' },
            
            // å¤–å¥— (Outerwear) - åš´æ ¼å–®é¸
            { category: 'å¤–å¥—', name: 'ä¸€èˆ¬å¤–å¥—', score: 4.5, icon: 'ğŸ§¥' }, 
            { category: 'å¤–å¥—', name: 'è–„é‡ç¹”å¤–å¥—', score: 4.0, icon: 'ğŸ§¶' }, 
            { category: 'å¤–å¥—', name: 'åšé‡ç¹”å¤–å¥—', score: 6.0, icon: 'ğŸ§£' },
            { category: 'å¤–å¥—', name: 'é˜²é¢¨å¤–å¥—', score: 5.0, icon: 'ğŸŒ¬ï¸' },
            { category: 'å¤–å¥—', name: 'åˆ·æ¯›å¤–å¥—', score: 7.0, icon: 'ğŸ‘' },
            { category: 'å¤–å¥—', name: 'å¤§è¡£', score: 8.0, icon: 'ğŸ‘‘' },
        ];

        // --- å¸¸æ•¸è¨­å®š ---
        const TARGET_TEMP = 26.0; 
        const COMFORT_RANGE_MIN = 25.0; 
        const COMFORT_RANGE_MAX = 27.0; 
        const TEMP_MAX = 30.0; 

        // --- ç‹€æ…‹ç®¡ç† ---
        let selectedItems = new Set(); 

        // --- DOM å…ƒç´  ---
        const $selector = document.getElementById('outfit-selector');
        const $totalScore = document.getElementById('total-score');
        const $adjustedTempInfo = document.getElementById('adjusted-temp-info');
        const $neededScoreInfo = document.getElementById('needed-score-info');
        const $currentBodyTemp = document.getElementById('current-body-temp');
        const $calibratorIndicator = document.getElementById('calibrator-indicator');
        const $outdoorIndicator = document.getElementById('outdoor-indicator');
        const $resultStatus = document.getElementById('result-status');
        const $resultMessage = document.getElementById('result-message');
        const $actionAdviceCard = document.getElementById('action-advice-card');
        const $actionAdviceText = document.getElementById('action-advice-text');
        
        const $inputOutdoorTemp = document.getElementById('input-outdoor-temp'); 

        const $recommendButton = document.getElementById('recommend-button');
        const $finalRecommendationList = document.getElementById('final-recommendation-list'); 

        // --- æ ¸å¿ƒé‚è¼¯å‡½æ•¸ï¼šUI é¡¯ç¤ºèˆ‡è¨ˆç®— ---

        /**
         * å°‡é«”æ„Ÿæº«åº¦è½‰æ›ç‚ºæº«åº¦è¨ˆä¸Šçš„ CSS left ä½ç½® (0-30Â°C ç¯„åœå…§)
         * @param {number} temp - é«”æ„Ÿæº«åº¦ (CÂ°)
         * @returns {string} CSS left value (percentage)
         */
        function tempToCssPosition(temp) {
            const clampedTemp = Math.max(0, Math.min(TEMP_MAX, temp));
            const percentage = (clampedTemp / TEMP_MAX) * 100; 
            return `${percentage}%`;
        }
        
        /**
         * æ›´æ–°æˆ¶å¤–é«”æ„ŸæŒ‡ç¤ºå™¨ã€‚
         * @param {number} outdoorTemp - è¨ˆç®—å‡ºçš„æˆ¶å¤–é«”æ„Ÿæº«åº¦ (T_æˆ¶å¤–)
         */
        function updateOutdoorIndicator(outdoorTemp) {
            const indicatorPosition = tempToCssPosition(outdoorTemp);
            $outdoorIndicator.style.left = indicatorPosition;
            $outdoorIndicator.title = `æˆ¶å¤–èµ·å§‹æº«åº¦: ${outdoorTemp.toFixed(1)}Â°C`;
        }

        /**
         * æ¸²æŸ“æ¨è–¦æ¸…å–®åˆ°å°ˆå±¬å€å¡Šã€‚
         * @param {Array<Set<string>>} recommendedOutfits - æ¨è–¦çš„å–®å“åç¨±é›†åˆé™£åˆ— (æœ€å¤šå…©çµ„)
         */
        function renderRecommendationList(recommendedOutfits) {
            if (recommendedOutfits.length === 0) {
                $finalRecommendationList.classList.add('hidden');
                return;
            }

            $finalRecommendationList.classList.remove('hidden');

            let listHtml = `<h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4">âœ… æ¨è–¦ç©¿æ­çµ„åˆ (${recommendedOutfits.length} çµ„)</h3>`;

            recommendedOutfits.forEach((recommendedItems, index) => {
                const optionNumber = index + 1;
                
                const optionScore = Array.from(recommendedItems).reduce((sum, name) => {
                    const item = OUTFIT_ITEMS.find(i => i.name === name);
                    return sum + (item ? item.score : 0);
                }, 0);
                
                
                listHtml += `<div class="mb-3 p-3 sm:p-4 border rounded-lg shadow-sm bg-white" style="color: var(--color-text-primary);">`; // æ¨è–¦æ¸…å–®èƒŒæ™¯ç”¨ç™½è‰²
                listHtml += `<p class="text-lg sm:text-xl font-bold" style="color: var(--color-accent-gray); margin-bottom: 0.5rem;">é¸é … ${optionNumber} (ç¸½é»æ•¸ +${optionScore.toFixed(1)}Â°C)</p>`;

                const categorized = {
                    'å¤–å¥—': [],
                    'ä¸Šè¡£': [], 
                    'å…§è¡£': [],
                    'è¤²å­': []
                };

                recommendedItems.forEach(name => {
                    const item = OUTFIT_ITEMS.find(i => i.name === name);
                    if (item && categorized.hasOwnProperty(item.category)) {
                       categorized[item.category].push(item);
                    }
                });

                listHtml += `<div class="space-y-1 sm:space-y-2">`;
                for (const category of ['å¤–å¥—', 'ä¸Šè¡£', 'å…§è¡£', 'è¤²å­']) {
                    const displayCategory = (category === 'ä¸Šè¡£' ? 'è¡£æœ' : category); 
                    const items = categorized[category];

                    if (items.length > 0) {
                        listHtml += `<p class="font-semibold text-xs sm:text-sm" style="color: var(--color-text-primary);">${displayCategory}ï¼š`;
                        listHtml += items.map(item => 
                            `<span class="text-sm sm:text-base ml-1">${item.icon} ${item.name} 
                            <span class="font-normal text-xs" style="color: var(--color-comfort-green);">(+${item.score.toFixed(1)}Â°C)</span></span>`
                        ).join(' / ');
                        listHtml += `</p>`;
                    }
                }
                listHtml += `</div>`;
                listHtml += `</div>`;
            });

            $finalRecommendationList.innerHTML = listHtml;
        }


        /**
         * åŸ·è¡Œæ ¸å¿ƒè¨ˆç®—ï¼Œæ›´æ–°æ‰€æœ‰ UI å…ƒç´ ã€‚
         * @param {boolean} isRecommendation - æ˜¯å¦ç‚ºæ¨è–¦æ¨¡å¼èª¿ç”¨
         */
        function updateTemperatureCalibrator(isRecommendation = false) {
            
            const T_outdoor_input_str = $inputOutdoorTemp.value;
            const T_outdoor_sensible = T_outdoor_input_str ? parseFloat(T_outdoor_input_str) : null; 

            if (T_outdoor_sensible === null || isNaN(T_outdoor_sensible)) {
                $adjustedTempInfo.textContent = '--Â°C';
                $neededScoreInfo.textContent = 'éœ€è¦æº«æš–é»æ•¸: --Â°C';
                $currentBodyTemp.textContent = '--Â°C';
                $outdoorIndicator.style.left = '0%'; 
                $calibratorIndicator.style.left = '0%'; 
                $calibratorIndicator.style.backgroundColor = 'gray'; 
                $resultStatus.textContent = 'è¨ˆç®—ä¸­...';
                $resultMessage.textContent = 'è«‹è¼¸å…¥ç•¶å‰ç’°å¢ƒé«”æ„Ÿæº«åº¦ã€‚';
                $totalScore.textContent = '0.0Â°C';
                return; 
            }
            
            const T_outdoor = T_outdoor_sensible;

            let totalScore = 0;
            OUTFIT_ITEMS.forEach(item => {
                if (selectedItems.has(item.name)) {
                    totalScore += item.score;
                }
            });

            const currentBodyTemp = T_outdoor + totalScore;
            const neededScore = TARGET_TEMP - T_outdoor;
            
            $totalScore.textContent = `${totalScore.toFixed(1)}Â°C`;
            $currentBodyTemp.textContent = `${currentBodyTemp.toFixed(1)}Â°C`;
            $adjustedTempInfo.textContent = `${T_outdoor.toFixed(1)}Â°C`; 
            
            const neededScoreSign = neededScore > 0 ? '' : '+'; 
            $neededScoreInfo.innerHTML = `éœ€è¦æº«æš–é»æ•¸: **${neededScoreSign}${neededScore.toFixed(1)}Â°C**`;

            updateOutdoorIndicator(T_outdoor);
            
            const indicatorPosition = tempToCssPosition(currentBodyTemp);
            $calibratorIndicator.style.left = indicatorPosition;

            let indicatorColor = '';
            let statusText = '';
            let messageText = '';
            let adviceVisible = isRecommendation; 
            
            if (!isRecommendation && selectedItems.size === 0) {
                 $finalRecommendationList.classList.add('hidden');
            }


            if (currentBodyTemp >= COMFORT_RANGE_MIN && currentBodyTemp <= COMFORT_RANGE_MAX) {
                // å®Œç¾èˆ’é© (Morandi Green)
                indicatorColor = 'var(--color-comfort-green)';
                statusText = 'âœ… å®Œç¾èˆ’é©ï¼';
                messageText = isRecommendation ? 'æ¨è–¦çµ„åˆè®“æ‚¨æ°å¥½è½åœ¨èˆ’é©å€é–“ï¼' : 'ç©¿æ­èˆ‡ç’°å¢ƒå®Œç¾åŒ¹é…ï¼Œäº«å—å¾å®¹ç©©å®šçš„ä¸€å¤©ã€‚';
            } else {
                
                const tempDiff = currentBodyTemp - TARGET_TEMP;

                if (tempDiff > 0) { // éç†± (Morandi Warm Red/Pink)
                    indicatorColor = 'var(--color-warm)';
                    statusText = 'ğŸ¥µ éç†±è­¦å‘Šï¼';
                    messageText = `ç•¶å‰é«”æ„Ÿé«˜æ–¼ç›®æ¨™ **${tempDiff.toFixed(1)}Â°C**ã€‚`;
                    
                } else { // éå†· (Morandi Cool Blue)
                    indicatorColor = 'var(--color-cool)';
                    statusText = 'ğŸ¥¶ éå†·æé†’ï¼';
                    messageText = `ç•¶å‰é«”æ„Ÿä½æ–¼ç›®æ¨™ **${Math.abs(tempDiff).toFixed(1)}Â°C**ã€‚`;
                }
            }
            
            $calibratorIndicator.style.backgroundColor = indicatorColor;
            $resultStatus.textContent = statusText;
            $resultMessage.textContent = messageText;

            // è™•ç†å»ºè­°å¡ç‰‡æ¨£å¼
            $actionAdviceCard.classList.remove('advice-card-info'); 

            $actionAdviceCard.classList.toggle('hidden', !adviceVisible);
            $actionAdviceCard.classList.add('advice-card-info');


            return T_outdoor;
        }


        /**
         * è¤‡é›œé‚è¼¯: æ ¹æ“šæ‰€éœ€åˆ†æ•¸ï¼Œæ‰¾åˆ°æœ€æ¥è¿‘ç›®æ¨™çš„ç©¿æ­çµ„åˆ (è€ƒæ…®å–®é¸å’Œå¤šé¸é™åˆ¶)ã€‚
         */
        function recommendOutfit(neededScore, T_outdoor) {
            
            if (isNaN(T_outdoor)) {
                return [];
            }
            
            const allOutfits = [];
            
            const addNoneOption = (items, category) => items.concat({ name: `ç„¡${category}`, score: 0, category: category, icon: 'â–' });

            const pantItems = OUTFIT_ITEMS.filter(item => item.category === 'è¤²å­');
            const topItems = OUTFIT_ITEMS.filter(item => item.category === 'ä¸Šè¡£'); 

            const innerItems = addNoneOption(OUTFIT_ITEMS.filter(item => item.category === 'å…§è¡£'), 'å…§è¡£');
            const outerItems = addNoneOption(OUTFIT_ITEMS.filter(item => item.category === 'å¤–å¥—'), 'å¤–å¥—');
            
            for (const pant of pantItems) {
                for (const top of topItems) {
                    for (const outer of outerItems) {
                        for (const inner of innerItems) {
                            
                            const currentTotalScore = pant.score + top.score + outer.score + inner.score;
                            const diff = Math.abs(neededScore - currentTotalScore);

                            const currentOutfit = new Set();
                            currentOutfit.add(pant.name); 
                            currentOutfit.add(top.name);  
                            if (outer.score > 0) currentOutfit.add(outer.name);
                            if (inner.score > 0) currentOutfit.add(inner.name);
                            
                            allOutfits.push({
                                outfit: currentOutfit,
                                diff: diff,
                                score: currentTotalScore
                            });
                        }
                    }
                }
            }
            
            allOutfits.sort((a, b) => a.diff - b.diff);

            const topOutfits = [];
            const uniqueOutfitSignatures = new Set();

            for (const outfitObj of allOutfits) {
                const signature = Array.from(outfitObj.outfit).sort().join('|');

                if (!uniqueOutfitSignatures.has(signature)) {
                    topOutfits.push(outfitObj);
                    uniqueOutfitSignatures.add(signature);
                    if (topOutfits.length >= 2) break; 
                }
            }

            const bestOutfitObj = topOutfits[0];
            if (bestOutfitObj) {
                const finalScore = bestOutfitObj.score;
                const finalTemp = T_outdoor + finalScore;

                $actionAdviceText.innerHTML = `
                    **æ‚¨çš„æˆ¶å¤–èµ·å§‹æº«åº¦ (T_æˆ¶å¤–)ï¼š** **${T_outdoor.toFixed(1)}Â°C** (ç›®æ¨™ **${TARGET_TEMP.toFixed(1)}Â°C**)ã€‚<br>
                    **ç³»çµ±æ¨è–¦ç¸½é»æ•¸ (é¸é …ä¸€)ï¼š** **${finalScore.toFixed(1)}Â°C**ï¼Œé è¨ˆæœ€çµ‚é«”æ„Ÿå°‡é”åˆ° **${finalTemp.toFixed(1)}Â°C**ã€‚
                `;

                const diffFromTarget = finalTemp - TARGET_TEMP;
                if (Math.abs(diffFromTarget) > 0.5) {
                    if (diffFromTarget > 0) {
                        $actionAdviceText.innerHTML += `<br><strong>âš ï¸ æ³¨æ„ï¼š</strong> æ¨è–¦ç¸½åˆ†é«˜å‡ºç›®æ¨™ **${diffFromTarget.toFixed(1)}Â°C**ï¼Œè«‹é ç•™è„«è¡£ç©ºé–“ã€‚`;
                    } else {
                        $actionAdviceText.innerHTML += `<br><strong>âš ï¸ æ³¨æ„ï¼š</strong> æ¨è–¦ç¸½åˆ†ä½æ–¼ç›®æ¨™ **${Math.abs(diffFromTarget).toFixed(1)}Â°C**ï¼Œå»ºè­°é¡å¤–æ·»åŠ åœå·¾æˆ–æ‰‹å¥—ç­‰é…ä»¶ã€‚`;
                    }
                }
            } else {
                $actionAdviceText.innerHTML = "æœªèƒ½æ‰¾åˆ°åˆé©çš„ç©¿æ­çµ„åˆã€‚è«‹æª¢æŸ¥è¼¸å…¥æº«åº¦ç¯„åœã€‚";
            }


            return topOutfits.map(o => o.outfit);
        }

        /**
         * è™•ç†æ¨è–¦æŒ‰éˆ•é»æ“Šäº‹ä»¶ã€‚
         */
        function handleRecommendButtonClick() {
            const T_outdoor_sensible = $inputOutdoorTemp.value ? parseFloat($inputOutdoorTemp.value) : null;
            
            if (T_outdoor_sensible === null || isNaN(T_outdoor_sensible)) {
                alert("è«‹å…ˆè¼¸å…¥ç•¶å‰ç’°å¢ƒé«”æ„Ÿæº«åº¦ï¼Œæ‰èƒ½é€²è¡Œç©¿æ­æ¨è–¦ï¼");
                return;
            }

            selectedItems.clear();
            // é‡ç½®æ‰€æœ‰æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('#outfit-selector button').forEach(button => {
                button.classList.remove('selected-item', 'shadow-md'); 
                button.classList.add('outfit-btn', 'hover:bg-gray-50');
            });

            const T_outdoor = updateTemperatureCalibrator(false);
            const neededScore = TARGET_TEMP - T_outdoor;

            const recommendedOutfits = recommendOutfit(neededScore, T_outdoor); 

            if (recommendedOutfits.length > 0) {
                const recommended = recommendedOutfits[0]; 
                
                recommended.forEach(name => {
                    if (!name.startsWith('ç„¡')) {
                        selectedItems.add(name);
                        const button = document.querySelector(`button[data-name='${name}']`);
                        if (button) {
                            // æ‡‰ç”¨é¸ä¸­æ¨£å¼
                            button.classList.add('selected-item', 'shadow-md');
                            button.classList.remove('outfit-btn', 'hover:bg-gray-50');
                        }
                    }
                });
            }

            renderRecommendationList(recommendedOutfits);

            updateTemperatureCalibrator(true);
        }

        /**
         * è™•ç†ç©¿æ­å–®å“é¸æ“‡äº‹ä»¶ (ä½¿ç”¨è€…æ‰‹å‹•é»æ“Š)ã€‚
         */
        function handleItemClick(event) {
            const button = event.currentTarget;
            const itemName = button.dataset.name;

            $finalRecommendationList.classList.add('hidden');
            $actionAdviceCard.classList.add('hidden'); 

            if (selectedItems.has(itemName)) {
                selectedItems.delete(itemName);
                // å–æ¶ˆé¸ä¸­
                button.classList.remove('selected-item', 'shadow-md');
                button.classList.add('outfit-btn', 'hover:bg-gray-50');
            } else {
                const itemCategory = button.dataset.category;
                
                if (itemCategory === 'å¤–å¥—' || itemCategory === 'è¤²å­') { 
                    OUTFIT_ITEMS.forEach(item => {
                        if (item.category === itemCategory && selectedItems.has(item.name)) {
                             selectedItems.delete(item.name);
                             const oldBtn = document.querySelector(`button[data-name='${item.name}']`);
                             if(oldBtn) {
                                // é‡ç½®èˆŠæŒ‰éˆ•æ¨£å¼
                                oldBtn.classList.remove('selected-item', 'shadow-md');
                                oldBtn.classList.add('outfit-btn', 'hover:bg-gray-50');
                             }
                        }
                    });
                }
                
                selectedItems.add(itemName);
                // é¸ä¸­
                button.classList.add('selected-item', 'shadow-md');
                button.classList.remove('outfit-btn', 'hover:bg-gray-50');
            }

            updateTemperatureCalibrator(false);
        }

        /**
         * åˆå§‹åŒ–ç©¿æ­å–®å“é¸æ“‡å™¨ UIã€‚
         */
        function initializeSelectorUI() {
            const displayCategories = ['å¤–å¥—', 'ä¸Šè¡£', 'å…§è¡£', 'è¤²å­'];

            const categorizedItems = OUTFIT_ITEMS.reduce((acc, item) => {
                acc[item.category] = acc[item.category] || [];
                acc[item.category].push(item);
                return acc;
            }, {});

            $selector.innerHTML = ''; 

            displayCategories.forEach(category => {
                const items = categorizedItems[category];
                if (items && items.length > 0) {
                    const displayCategory = (category === 'ä¸Šè¡£' ? 'è¡£æœ' : category); 

                    const categoryTitle = document.createElement('h4');
                    categoryTitle.className = "col-span-3 text-base sm:text-lg font-bold mt-4 mb-2 border-b pb-1";
                    categoryTitle.textContent = displayCategory;
                    $selector.appendChild(categoryTitle);

                    items.forEach(item => {
                        const button = document.createElement('button');
                        // ä½¿ç”¨ outfit-btn class å¯¦ç¾æ¨£å¼æ§åˆ¶
                        button.className = `card outfit-btn text-center transition duration-150 ease-in-out hover:bg-gray-50 p-2 sm:p-3 flex flex-col items-center justify-center h-full w-full break-words`;
                        button.dataset.name = item.name;
                        button.dataset.category = item.category;

                        button.innerHTML = `
                            <span class="text-lg sm:text-xl mb-1">${item.icon}</span>
                            <span class="text-xs sm:text-sm font-medium leading-tight w-full">${item.name}</span>
                            <span class="text-xs mt-1" style="color: #ADADAD;">${item.score.toFixed(1)}Â°C</span>
                        `;
                        button.addEventListener('click', handleItemClick);
                        $selector.appendChild(button);
                    });
                }
            });
        }
        
        // --- åˆå§‹åŒ– APP ---
        window.onload = () => {
            initializeSelectorUI();
            $recommendButton.addEventListener('click', handleRecommendButtonClick);
            
            updateTemperatureCalibrator();
        };

        function alert(message) {
            console.error("Alert:", message);
            $resultStatus.textContent = "â— éŒ¯èª¤";
            $resultMessage.textContent = message;
        }

    </script>
</body>
</html>
