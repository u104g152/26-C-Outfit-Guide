<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>26Â°C æº«åº¦èª¿æ ¡å„€ - é«”æ„Ÿè¼¸å…¥æ¨¡å¼ (éŸ¿æ‡‰å¼)</title>
    <!-- å¼•å…¥ Tailwind CSS å¯¦ç¾ç°¡ç´„æº«å’Œè¨­è¨ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªè¨‚è«è˜­è¿ªè‰²èª¿å’Œå­—é«” */
        :root {
            --color-bg-light: #F9F7F4; /* æš–ç±³ç™½èƒŒæ™¯ */
            --color-text-dark: #333333; /* æ·±è‰²æ–‡å­— */
            --color-comfort-green: #A3B8A8; /* æŸ”å’Œæ·¡ç°ç¶  - èˆ’é©å€ */
            --color-warm: #E68A8A; /* æŸ”å’Œç´… - éç†± */
            --color-cool: #7ABAC8; /* æŸ”å’Œè— - éå†· */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text-dark);
            min-height: 10vh;
        }
        .card {
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border-radius: 1rem;
            padding: 1.5rem;
        }
        /* æ ¸å¿ƒæº«åº¦è¨ˆæ¨£å¼ - æ©«å‘ä½ˆå±€èª¿æ•´ */
        #calibrator-track {
            height: 16px; /* è»Œé“é«˜åº¦ */
            width: 100%; /* ä½”æ»¿å¯¬åº¦ */
            background-color: #E0E0E0;
            border-radius: 8px;
            position: relative;
        }
        .comfort-zone {
            position: absolute;
            background-color: var(--color-comfort-green);
            opacity: 0.6;
            height: 100%; /* ä½”æ»¿è»Œé“é«˜åº¦ */
            border-radius: 4px;
            /* 25Â°C (83.33%) åˆ° 27Â°C (90.00%) åœ¨ 0-30Â°C ç¯„åœå…§ */
            left: 83.333%; 
            width: 6.667%;
        }
        /* æœ€çµ‚é«”æ„Ÿæº«åº¦æŒ‡ç¤ºå™¨ */
        #calibrator-indicator {
            position: absolute;
            top: 50%; /* å‚ç›´å±…ä¸­ */
            transform: translateY(-50%) translateX(-50%); /* ç¢ºä¿åœ“å¿ƒå°é½Šåˆ»åº¦ */
            width: 24px;
            height: 24px;
            border-radius: 50%;
            transition: all 0.8s ease-out;
            border: 3px solid white;
            /* left ä½ç½®å°‡ç”± JS è¨­ç½® */
        }
        /* æˆ¶å¤–é«”æ„Ÿæº«åº¦æŒ‡ç¤ºç·š (ç¾ç‚ºå‚ç›´ç·š) */
        #outdoor-indicator {
            position: absolute;
            top: 0;
            height: 100%;
            width: 2px; /* å‚ç›´ç·šå¯¬åº¦ */
            background-color: #A0A0A0; 
            transition: left 0.8s ease-out;
            /* left ä½ç½®å°‡ç”± JS è¨­ç½® */
        }
        .input-box {
            border: 1px solid #D1D5DB;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 1.125rem;
            text-align: center;
        }
        /* é‡å°æ‰‹æ©Ÿå„ªåŒ– - è®“å¡ç‰‡å…§å®¹æ›´ç·Šæ¹Š */
        @media (max-width: 639px) {
            .card {
                padding: 1rem; /* æ¸›å°æ‰‹æ©Ÿä¸Šçš„å¡ç‰‡å…§é‚Šè· */
            }
        }
    </style>
</head>
<body class="flex flex-col items-center p-4 sm:p-8">

    <header class="text-center mb-6 sm:mb-8">
        <h1 class="text-2xl sm:text-4xl font-bold text-gray-800">26Â°C æº«åº¦èª¿æ ¡å„€</h1>
        <p class="text-sm sm:text-base text-gray-500 mt-1">ç›®æ¨™é«”æ„Ÿèˆ’é©æº«åº¦ï¼š<span class="font-semibold text-gray-700">26Â°C</span></p>
    </header>

    <main class="w-full max-w-4xl space-y-4 sm:space-y-6">

        <!-- æˆ¶å¤–é«”æ„Ÿæº«åº¦è¼¸å…¥å€ - ç¾åœ¨åªæœ‰ä¸€å€‹æ¬„ä½ -->
        <section class="card">
            <h3 class="text-lg sm:text-xl font-semibold mb-4 text-gray-800">1. æˆ¶å¤–èµ·å§‹æº«åº¦è¼¸å…¥ (T_æˆ¶å¤–)</h3>
            <div class="flex justify-center">
                
                <!-- é«”æ„Ÿæº«åº¦ (T_sensible) - ä½œç‚ºå”¯ä¸€çš„ç’°å¢ƒè¼¸å…¥ -->
                <div class="w-full max-w-xs">
                    <label for="input-outdoor-temp" class="text-base sm:text-lg font-medium block mb-2 text-center text-gray-700">
                        ç•¶å‰ç’°å¢ƒé«”æ„Ÿæº«åº¦
                    </label>
                    <input type="number" id="input-outdoor-temp" min="-10" max="40" step="0.5" value="" placeholder="è«‹è¼¸å…¥Â°C" class="input-box w-full mx-auto block" oninput="updateTemperatureCalibrator()">
                    <p class="text-xs text-gray-500 mt-1 text-center">å–®ä½ï¼šÂ°C (è«‹è¼¸å…¥æ‚¨ç•¶ä¸‹çš„é«”æ„Ÿæº«åº¦æˆ–æ°£æº«)</p>
                </div>
            </div>

            <!-- è¨ˆç®—çµæœé¡¯ç¤º -->
            <div class="text-lg sm:text-xl font-extrabold text-gray-800 border-t pt-4 mt-4 w-full text-center">
                <p class="text-sm font-light text-gray-500 mb-1">æˆ¶å¤–èµ·å§‹æº«åº¦ (T_æˆ¶å¤–)</p>
                <span id="adjusted-temp-info" class="text-3xl sm:text-4xl text-gray-900">--Â°C</span>
                <span id="needed-score-info" class="text-sm font-light text-gray-500 block">éœ€è¦æº«æš–é»æ•¸: --Â°C</span>
            </div>
        </section>

        <!-- æ ¸å¿ƒæº«åº¦èª¿æ ¡å„€èˆ‡çµæœ -->
        <!-- flex-col on mobile, flex-row on large screen -->
        <section class="card flex flex-col lg:flex-row justify-between items-start space-y-6 lg:space-y-0 lg:space-x-8">
            
            <!-- å·¦å´ï¼šèª¿æ ¡å„€è¦–è¦ºåŒ–ã€æŒ‰éˆ•å’Œæ¨è–¦æ¸…å–® -->
            <div class="w-full lg:w-1/3 flex flex-col items-center justify-center">
                <!-- æ°´å¹³æŒ‡æ¨™æ¢å®¹å™¨ -->
                <div id="calibrator-container" class="relative w-full h-16 mb-8 pt-4"> 
                    <!-- 26C ç›®æ¨™ç·š (ç¾åœ¨æ˜¯å‚ç›´ç·š) -->
                    <div class="absolute top-0 w-px h-full bg-gray-700" style="left: 86.667%; z-index: 10;"></div> 
                    <span class="absolute -top-6 text-xs font-semibold text-gray-700" style="left: 86.667%; transform: translateX(-50%);">26Â°C (ç›®æ¨™)</span>
                    
                    <!-- æº«åº¦è»Œé“ -->
                    <div id="calibrator-track" class="absolute bottom-0">
                        <!-- èˆ’é©å€æ¨™ç¤º: 25Â°C - 27Â°C (83.33% - 90.00%) -->
                        <div class="comfort-zone"></div>
                        
                        <!-- æˆ¶å¤–é«”æ„Ÿæº«åº¦æŒ‡ç¤ºç·š (T_æˆ¶å¤–) -->
                        <div id="outdoor-indicator" style="z-index: 5;"></div>
                        
                        <!-- é«”æ„ŸæŒ‡ç¤ºå™¨ (æœ€çµ‚é«”æ„Ÿ T_é«”æ„Ÿ) -->
                        <div id="calibrator-indicator" class="bg-gray-700" style="z-index: 20;"></div>
                    </div>
                </div>

                <!-- çµæœèˆ‡æŒ‰éˆ• -->
                <div class="text-center mt-4 w-full">
                    <h2 id="result-status" class="text-xl font-bold text-gray-700">è¨ˆç®—ä¸­...</h2>
                    <p id="result-message" class="text-gray-500 mt-1">è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•é€²è¡Œæ¨è–¦ã€‚</p>
                </div>
                
                <!-- æ¨è–¦æŒ‰éˆ• - è«è˜­è¿ªè—è‰² -->
                <button id="recommend-button" class="mt-4 w-full max-w-xs bg-slate-500 hover:bg-slate-600 text-white font-bold py-2.5 px-5 rounded-xl transition duration-150 shadow-lg shadow-slate-300">
                    âœ¨ æ¨è–¦æœ€é©åˆç©¿æ­
                </button>
                
                <!-- æ¨è–¦æ¸…å–®é¡¯ç¤ºå€ (ç§»å‹•åˆ°æŒ‰éˆ•ä¸‹æ–¹) -->
                <div id="final-recommendation-list" class="pt-4 mt-4 w-full hidden">
                     <!-- List will be populated here by JS -->
                </div>
            </div>

            <!-- å³å´ï¼šç©¿æ­é»æ•¸é¸æ“‡å™¨ -->
            <div class="w-full lg:w-2/3 space-y-4">
                <h3 class="text-lg sm:text-xl font-semibold mb-2 text-gray-800">2. é¸æ“‡æ‚¨çš„å–®å“ (åŠ æº«é»æ•¸ Â°C)</h3>
                
                <!-- èª¿æ•´ç‚º 3 æ¬„ä½ˆå±€ä»¥é©æ‡‰æ›´å¤šé …ç›®ï¼Œä¸¦åˆ†å±¤é¡¯ç¤º -->
                <div id="outfit-selector" class="grid grid-cols-3 gap-2 sm:gap-3">
                    <!-- é …ç›®å°‡ç”± JS æ¸²æŸ“ -->
                </div>

                <div class="border-t pt-4 mt-4 flex justify-between items-center">
                    <p class="text-lg font-medium">ç©¿æ­ç¸½é»æ•¸ (T_é»æ•¸):</p>
                    <p id="total-score" class="text-3xl font-extrabold text-gray-800">0.0Â°C</p>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <p class="text-lg font-medium">æœ€çµ‚é«”æ„Ÿæº«åº¦ (T_é«”æ„Ÿ):</p>
                    <p id="current-body-temp" class="text-3xl font-extrabold text-gray-800">--Â°C</p>
                </div>

            </div>
        </section>

        <!-- è¡Œå‹•å°å‘å»ºè­°å¡ç‰‡ (åªç”¨æ–¼é¡¯ç¤ºæ¨è–¦çµæœ) -->
        <section id="action-advice-card" class="card p-4 sm:p-6 bg-blue-100 border-l-4 border-blue-500 hidden">
            <h3 class="text-lg sm:text-xl font-semibold text-gray-800">ğŸ’¡ ç©¿æ­å»ºè­°</h3>
            <p id="action-advice-text" class="text-gray-700 mt-2 text-sm sm:text-base"></p>
        </section>
    </main>

    <script>
        // --- æ ¸å¿ƒæ•¸æ“šæ¨¡å‹ ---
        const OUTFIT_ITEMS = [
            // å…§è¡£ (Innerwear) - å¯å¤šé¸
            { category: 'å…§è¡£', name: 'ç™¼ç†±è¡£', score: 4.0, icon: 'ğŸ”¥' }, 
            { category: 'å…§è¡£', name: 'åˆ·æ¯›èƒŒå¿ƒ', score: 3.0, icon: 'ğŸ½' }, 
            
            // ä¸Šè¡£ (Top / Mid-layers) - å¯å¤šé¸ (å°æ‡‰ä½¿ç”¨è€…çš„ã€Œè¡£æœã€é¡åˆ¥)
            { category: 'ä¸Šè¡£', name: 'è–„æ£‰T', score: 1.0, icon: 'ğŸ‘š' },
            { category: 'ä¸Šè¡£', name: 'å¤§å­¸T / åšTæ¤', score: 2.5, icon: 'ğŸ‘•' },
            { category: 'ä¸Šè¡£', name: 'è–„é‡ç¹”', score: 3.0, icon: 'ğŸ§¶' }, // ä¸­å±¤çš„è–„é‡ç¹”è¡«/æ¯›è¡£
            { category: 'ä¸Šè¡£', name: 'åšé‡ç¹”', score: 5.0, icon: 'ğŸ§£' }, // ä¸­å±¤çš„åšæ¯›è¡£
            
            // è¤²å­ (Bottoms) - åš´æ ¼å–®é¸
            { category: 'è¤²å­', name: 'ç‰›ä»”è¤²', score: 2.0, icon: 'ğŸ‘–' },
            { category: 'è¤²å­', name: 'æ£‰è¤²', score: 2.5, icon: 'æ£‰' },
            { category: 'è¤²å­', name: 'åˆ·æ¯›è¤²', score: 4.5, icon: 'ğŸ‘–' },
            { category: 'è¤²å­', name: 'é•·è£™', score: 1.5, icon: 'ğŸ‘—' },
            
            // å¤–å¥— (Outerwear) - åš´æ ¼å–®é¸
            { category: 'å¤–å¥—', name: 'ä¸€èˆ¬å¤–å¥—', score: 4.5, icon: 'ğŸ§¥' }, 
            { category: 'å¤–å¥—', name: 'è–„é‡ç¹”å¤–å¥—', score: 4.0, icon: 'ğŸ§¶' }, 
            { category: 'å¤–å¥—', name: 'åšé‡ç¹”å¤–å¥—', score: 6.0, icon: 'ğŸ§£' },
            { category: 'å¤–å¥—', name: 'é˜²é¢¨å¤–å¥—', score: 5.0, icon: 'ğŸŒ¬ï¸' },
            { category: 'å¤–å¥—', name: 'åˆ·æ¯›å¤–å¥—', score: 7.0, icon: 'ğŸ‘' },
            { category: 'å¤–å¥—', name: 'å¤§è¡£', score: 8.0, icon: 'ğŸ‘‘' },
        ];

        // --- å¸¸æ•¸è¨­å®š ---
        const TARGET_TEMP = 26.0; // ç›®æ¨™èˆ’é©æº«åº¦
        const COMFORT_RANGE_MIN = 25.0; // èˆ’é©å€é–“ä¸‹é™
        const COMFORT_RANGE_MAX = 27.0; // èˆ’é©å€é–“ä¸Šé™
        const TEMP_MAX = 30.0; // æº«åº¦è¨ˆé¡¯ç¤ºçš„æœ€é«˜æº«åº¦ (0Â°C åˆ° 30Â°C)

        // --- ç‹€æ…‹ç®¡ç† ---
        let selectedItems = new Set(); // å„²å­˜é¸ä¸­çš„å–®å“åç¨±

        // --- DOM å…ƒç´  ---
        const $selector = document.getElementById('outfit-selector');
        const $totalScore = document.getElementById('total-score');
        const $adjustedTempInfo = document.getElementById('adjusted-temp-info');
        const $neededScoreInfo = document.getElementById('needed-score-info');
        const $currentBodyTemp = document.getElementById('current-body-temp');
        const $calibratorIndicator = document.getElementById('calibrator-indicator');
        const $outdoorIndicator = document.getElementById('outdoor-indicator');
        const $resultStatus = document.getElementById('result-status');
        const $resultMessage = document.getElementById('result-message');
        const $actionAdviceCard = document.getElementById('action-advice-card');
        const $actionAdviceText = document.getElementById('action-advice-text');
        
        // è¼¸å…¥å…ƒç´ 
        const $inputOutdoorTemp = document.getElementById('input-outdoor-temp'); // ç¾åœ¨é€™æ˜¯å”¯ä¸€çš„ç’°å¢ƒè¼¸å…¥

        const $recommendButton = document.getElementById('recommend-button');
        const $finalRecommendationList = document.getElementById('final-recommendation-list'); 

        // --- æ ¸å¿ƒé‚è¼¯å‡½æ•¸ï¼šUI é¡¯ç¤ºèˆ‡è¨ˆç®— ---

        /**
         * å°‡é«”æ„Ÿæº«åº¦è½‰æ›ç‚ºæº«åº¦è¨ˆä¸Šçš„ CSS left ä½ç½® (0-30Â°C ç¯„åœå…§)
         * @param {number} temp - é«”æ„Ÿæº«åº¦ (CÂ°)
         * @returns {string} CSS left value (percentage)
         */
        function tempToCssPosition(temp) {
            // 0Â°C -> 0%, 30Â°C -> 100%
            const clampedTemp = Math.max(0, Math.min(TEMP_MAX, temp));
            // Calculate position as a percentage of the width
            const percentage = (clampedTemp / TEMP_MAX) * 100; 
            return `${percentage}%`;
        }
        
        /**
         * æ›´æ–°æˆ¶å¤–é«”æ„ŸæŒ‡ç¤ºå™¨ã€‚
         * @param {number} outdoorTemp - è¨ˆç®—å‡ºçš„æˆ¶å¤–é«”æ„Ÿæº«åº¦ (T_æˆ¶å¤–)
         */
        function updateOutdoorIndicator(outdoorTemp) {
            const indicatorPosition = tempToCssPosition(outdoorTemp);
            $outdoorIndicator.style.left = indicatorPosition;
            $outdoorIndicator.title = `æˆ¶å¤–èµ·å§‹æº«åº¦: ${outdoorTemp.toFixed(1)}Â°C`;
        }

        /**
         * æ¸²æŸ“æ¨è–¦æ¸…å–®åˆ°å°ˆå±¬å€å¡Šã€‚
         * @param {Array<Set<string>>} recommendedOutfits - æ¨è–¦çš„å–®å“åç¨±é›†åˆé™£åˆ— (æœ€å¤šå…©çµ„)
         */
        function renderRecommendationList(recommendedOutfits) {
            // å¦‚æœæ²’æœ‰æ¨è–¦é …ç›®ï¼Œå‰‡éš±è—
            if (recommendedOutfits.length === 0) {
                $finalRecommendationList.classList.add('hidden');
                return;
            }

            // 1. é¡¯ç¤ºå®¹å™¨
            $finalRecommendationList.classList.remove('hidden');

            let listHtml = `<h3 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-gray-800">âœ… æ¨è–¦ç©¿æ­çµ„åˆ (${recommendedOutfits.length} çµ„)</h3>`;

            // éæ­·æ¯ä¸€çµ„æ¨è–¦
            recommendedOutfits.forEach((recommendedItems, index) => {
                const optionNumber = index + 1;
                
                // 1. è¨ˆç®—è©²é¸é …çš„ç¸½åˆ†
                const optionScore = Array.from(recommendedItems).reduce((sum, name) => {
                    const item = OUTFIT_ITEMS.find(i => i.name === name);
                    return sum + (item ? item.score : 0);
                }, 0);
                
                // ç‚ºäº†é¡¯ç¤ºæ›´è²¼è¿‘ä½¿ç”¨è€…ç”¨èªï¼Œå°‡ 'ä¸Šè¡£' é¡¯ç¤ºç‚º 'è¡£æœ'
                
                listHtml += `<div class="mb-3 p-3 sm:p-4 border rounded-lg shadow-sm bg-gray-50">`;
                listHtml += `<p class="text-lg sm:text-xl font-bold text-slate-700 mb-2">é¸é … ${optionNumber} (ç¸½é»æ•¸ +${optionScore.toFixed(1)}Â°C)</p>`;

                // 2. ä¾æ–°åˆ†é¡æ•´ç†å–®å“ (æŒ‰ç…§ç©¿è„«é †åº: å¤–å¥—, ä¸Šè¡£, å…§è¡£, è¤²å­)
                const categorized = {
                    'å¤–å¥—': [],
                    'ä¸Šè¡£': [], 
                    'å…§è¡£': [],
                    'è¤²å­': []
                };

                recommendedItems.forEach(name => {
                    const item = OUTFIT_ITEMS.find(i => i.name === name);
                    if (item && categorized.hasOwnProperty(item.category)) {
                       categorized[item.category].push(item);
                    }
                });

                // 3. æ§‹å»º HTML åˆ—è¡¨
                listHtml += `<div class="space-y-1 sm:space-y-2">`;
                for (const category of ['å¤–å¥—', 'ä¸Šè¡£', 'å…§è¡£', 'è¤²å­']) {
                    const displayCategory = (category === 'ä¸Šè¡£' ? 'è¡£æœ' : category); 
                    const items = categorized[category];

                    if (items.length > 0) {
                        listHtml += `<p class="font-semibold text-xs sm:text-sm text-gray-600">${displayCategory}ï¼š`;
                        listHtml += items.map(item => 
                            `<span class="text-sm sm:text-base text-gray-800 ml-1">${item.icon} ${item.name} 
                            <span class="font-normal text-xs text-comfort-green">(+${item.score.toFixed(1)}Â°C)</span></span>`
                        ).join(' / ');
                        listHtml += `</p>`;
                    }
                }
                listHtml += `</div>`;
                listHtml += `</div>`;
            });

            $finalRecommendationList.innerHTML = listHtml;
        }


        /**
         * åŸ·è¡Œæ ¸å¿ƒè¨ˆç®—ï¼Œæ›´æ–°æ‰€æœ‰ UI å…ƒç´ ã€‚
         * @param {boolean} isRecommendation - æ˜¯å¦ç‚ºæ¨è–¦æ¨¡å¼èª¿ç”¨
         */
        function updateTemperatureCalibrator(isRecommendation = false) {
            
            // 0. è®€å–è¼¸å…¥å€¼
            const T_outdoor_input_str = $inputOutdoorTemp.value;
            const T_outdoor_sensible = T_outdoor_input_str ? parseFloat(T_outdoor_input_str) : null; 

            // è™•ç†åˆå§‹ç©ºç™½æˆ–ç„¡æ•ˆè¼¸å…¥çš„æƒ…æ³
            if (T_outdoor_sensible === null || isNaN(T_outdoor_sensible)) {
                $adjustedTempInfo.textContent = '--Â°C';
                $neededScoreInfo.textContent = 'éœ€è¦æº«æš–é»æ•¸: --Â°C';
                $currentBodyTemp.textContent = '--Â°C';
                $outdoorIndicator.style.left = '0%'; // å°‡æŒ‡æ¨™è¨­ç‚º 0
                $calibratorIndicator.style.left = '0%'; // å°‡æŒ‡æ¨™è¨­ç‚º 0
                $calibratorIndicator.style.backgroundColor = 'gray'; // è¨­ç‚ºç°è‰²
                $resultStatus.textContent = 'è¨ˆç®—ä¸­...';
                $resultMessage.textContent = 'è«‹è¼¸å…¥ç•¶å‰ç’°å¢ƒé«”æ„Ÿæº«åº¦ã€‚';
                $totalScore.textContent = '0.0Â°C';
                return; // çµ‚æ­¢å¾ŒçºŒè¨ˆç®—
            }
            
            // T_æˆ¶å¤– (ç¾åœ¨ç›´æ¥ä½¿ç”¨è¼¸å…¥å€¼)
            const T_outdoor = T_outdoor_sensible;


            // 1. è¨ˆç®—ç©¿æ­ç¸½é»æ•¸ (T_é»æ•¸)
            let totalScore = 0;
            OUTFIT_ITEMS.forEach(item => {
                if (selectedItems.has(item.name)) {
                    totalScore += item.score;
                }
            });

            // 2. è¨ˆç®—ç•¶å‰é«”æ„Ÿæº«åº¦ (T_é«”æ„Ÿ) èˆ‡æ‰€éœ€é»æ•¸
            const currentBodyTemp = T_outdoor + totalScore;
            const neededScore = TARGET_TEMP - T_outdoor;
            
            // 3. æ›´æ–° UI æ•¸å­—
            $totalScore.textContent = `${totalScore.toFixed(1)}Â°C`;
            $currentBodyTemp.textContent = `${currentBodyTemp.toFixed(1)}Â°C`;
            $adjustedTempInfo.textContent = `${T_outdoor.toFixed(1)}Â°C`; // é¡¯ç¤º T_æˆ¶å¤–
            
            // ç¢ºä¿éœ€è¦çš„é»æ•¸é¡¯ç¤ºæ­£ç¢ºçš„ + / - ç¬¦è™Ÿ
            const neededScoreSign = neededScore > 0 ? '' : '+'; // å¦‚æœneededScoreæ˜¯è² æ•¸ (æº«åº¦é«˜)ï¼Œå‰‡é¡¯ç¤º +
            $neededScoreInfo.innerHTML = `éœ€è¦æº«æš–é»æ•¸: **${neededScoreSign}${neededScore.toFixed(1)}Â°C**`;

            // 4. æ›´æ–°æˆ¶å¤–é«”æ„ŸæŒ‡ç¤ºå™¨ä½ç½® (ä½¿ç”¨ T_æˆ¶å¤–)
            updateOutdoorIndicator(T_outdoor);
            
            // 5. æ›´æ–°æœ€çµ‚é«”æ„Ÿæº«åº¦æŒ‡ç¤ºå™¨ä½ç½®å’Œé¡è‰² (ä½¿ç”¨ T_é«”æ„Ÿ)
            const indicatorPosition = tempToCssPosition(currentBodyTemp);
            $calibratorIndicator.style.left = indicatorPosition;

            let indicatorColor = '';
            let statusText = '';
            let messageText = '';
            let adviceVisible = isRecommendation; // åªæœ‰åœ¨æ¨è–¦æ¨¡å¼ä¸‹æ‰é¡¯ç¤ºå»ºè­°å¡ç‰‡
            
            // å¦‚æœä¸æ˜¯æ¨è–¦æ¨¡å¼ï¼Œä¸”é¸ä¸­é …ç›®ç‚ºç©ºï¼Œå‰‡éš±è—æ¨è–¦æ¸…å–®
            if (!isRecommendation && selectedItems.size === 0) {
                 $finalRecommendationList.classList.add('hidden');
            }


            // 6. åˆ¤æ–·èˆ’é©ç‹€æ…‹ (æ ¸å¿ƒåˆ¤è®€)
            if (currentBodyTemp >= COMFORT_RANGE_MIN && currentBodyTemp <= COMFORT_RANGE_MAX) {
                // å®Œç¾èˆ’é© (ç¶ è‰²å€å¡Š)
                indicatorColor = 'var(--color-comfort-green)';
                statusText = 'âœ… å®Œç¾èˆ’é©ï¼';
                messageText = isRecommendation ? 'æ¨è–¦çµ„åˆè®“æ‚¨æ°å¥½è½åœ¨èˆ’é©å€é–“ï¼' : 'ç©¿æ­èˆ‡ç’°å¢ƒå®Œç¾åŒ¹é…ï¼Œäº«å—å¾å®¹ç©©å®šçš„ä¸€å¤©ã€‚';
            } else {
                
                const tempDiff = currentBodyTemp - TARGET_TEMP;

                if (tempDiff > 0) { // éç†±
                    indicatorColor = 'var(--color-warm)';
                    statusText = 'ğŸ¥µ éç†±è­¦å‘Šï¼';
                    messageText = `ç•¶å‰é«”æ„Ÿé«˜æ–¼ç›®æ¨™ **${tempDiff.toFixed(1)}Â°C**ã€‚`;
                    
                } else { // éå†·
                    indicatorColor = 'var(--color-cool)';
                    statusText = 'ğŸ¥¶ éå†·æé†’ï¼';
                    messageText = `ç•¶å‰é«”æ„Ÿä½æ–¼ç›®æ¨™ **${Math.abs(tempDiff).toFixed(1)}Â°C**ã€‚`;
                }
            }
            
            // 7. æ›´æ–°ç‹€æ…‹æ–‡å­—å’ŒæŒ‡ç¤ºå™¨é¡è‰²
            $calibratorIndicator.style.backgroundColor = indicatorColor;
            $resultStatus.textContent = statusText;
            $resultMessage.textContent = messageText;

            // 8. é¡¯ç¤º/éš±è—è¡Œå‹•å»ºè­°å¡ç‰‡ (åªæœ‰åœ¨æ¨è–¦æ¨¡å¼ä¸‹æ‰é¡¯ç¤º)
            
            // çµ±ä¸€ç§»é™¤æ‰€æœ‰é¡è‰²èƒŒæ™¯é¡åˆ¥ï¼Œé˜²æ­¢éŒ¯èª¤å †ç–Š
            $actionAdviceCard.classList.remove(
                'bg-blue-100', 'border-blue-500', 
                'bg-red-100', 'border-red-500', 
                'bg-comfort-green/20', 'border-comfort-green'
            );

            $actionAdviceCard.classList.toggle('hidden', !adviceVisible);

            // è¿”å›è¨ˆç®—å¾Œçš„æˆ¶å¤–é«”æ„Ÿæº«åº¦ï¼Œä¾› recommendOutfit ä½¿ç”¨
            return T_outdoor;
        }


        /**
         * è¤‡é›œé‚è¼¯: æ ¹æ“šæ‰€éœ€åˆ†æ•¸ï¼Œæ‰¾åˆ°æœ€æ¥è¿‘ç›®æ¨™çš„ç©¿æ­çµ„åˆ (è€ƒæ…®å–®é¸å’Œå¤šé¸é™åˆ¶)ã€‚
         * @param {number} neededScore - éœ€è¦çš„ç¸½åˆ†æ•¸ (26.0 - T_æˆ¶å¤–)
         * @param {number} T_outdoor - æˆ¶å¤–èµ·å§‹æº«åº¦
         * @returns {Array<Set<string>>} - æ¨è–¦çš„å–®å“åç¨±é›†åˆ (æœ€å¤šå…©çµ„)
         */
        function recommendOutfit(neededScore, T_outdoor) {
            
            // å¦‚æœæˆ¶å¤–é«”æ„Ÿæº«åº¦ç„¡æ³•è¨ˆç®—ï¼Œå‰‡ä¸é€²è¡Œæ¨è–¦
            if (isNaN(T_outdoor)) {
                return [];
            }
            
            const allOutfits = [];
            
            // å®šç¾© helperï¼šæ˜¯å¦æ·»åŠ  "ç„¡" é¸é …
            const addNoneOption = (items, category) => items.concat({ name: `ç„¡${category}`, score: 0, category: category, icon: 'â–' });

            // 1. å¼·åˆ¶å±¤æ¬¡ (Mandatory) - ä¸åŠ  "ç„¡"
            const pantItems = OUTFIT_ITEMS.filter(item => item.category === 'è¤²å­');
            const topItems = OUTFIT_ITEMS.filter(item => item.category === 'ä¸Šè¡£'); 

            // 2. å¯é¸å±¤æ¬¡ (Optional) - åŠ  "ç„¡"
            const innerItems = addNoneOption(OUTFIT_ITEMS.filter(item => item.category === 'å…§è¡£'), 'å…§è¡£');
            const outerItems = addNoneOption(OUTFIT_ITEMS.filter(item => item.category === 'å¤–å¥—'), 'å¤–å¥—');
            
            // 3. éæ­·çµ„åˆ (ç´„ 1152 ç¨®çµ„åˆ)
            for (const pant of pantItems) {
                for (const top of topItems) {
                    for (const outer of outerItems) {
                        for (const inner of innerItems) {
                            
                            const currentTotalScore = pant.score + top.score + outer.score + inner.score;
                            const diff = Math.abs(neededScore - currentTotalScore);

                            // æ§‹å»ºç•¶å‰ç©¿æ­
                            const currentOutfit = new Set();
                            currentOutfit.add(pant.name); 
                            currentOutfit.add(top.name);  
                            if (outer.score > 0) currentOutfit.add(outer.name);
                            if (inner.score > 0) currentOutfit.add(inner.name);
                            
                            allOutfits.push({
                                outfit: currentOutfit,
                                diff: diff,
                                score: currentTotalScore
                            });
                        }
                    }
                }
            }
            
            // 4. æ’åºä¸¦ç¯©é¸å‰å…©åï¼Œç¢ºä¿çµ„åˆä¸åŒ
            allOutfits.sort((a, b) => a.diff - b.diff);

            const topOutfits = [];
            const uniqueOutfitSignatures = new Set();

            for (const outfitObj of allOutfits) {
                // å‰µå»ºä¸€å€‹ç©©å®šçš„ç°½åä¾†è­˜åˆ¥é‡è¤‡çš„ç©¿æ­çµ„åˆ (ä¾‹å¦‚ï¼šTæ¤|ç‰›ä»”è¤²|è–„å¤–å¥—)
                const signature = Array.from(outfitObj.outfit).sort().join('|');

                if (!uniqueOutfitSignatures.has(signature)) {
                    topOutfits.push(outfitObj);
                    uniqueOutfitSignatures.add(signature);
                    if (topOutfits.length >= 2) break; // æ‰¾åˆ°å…©çµ„å°±åœæ­¢
                }
            }


            // 5. æ›´æ–°å»ºè­°æ–‡å­— - ä½¿ç”¨ç¬¬ä¸€çµ„çš„æœ€ä½³æ­é…é€²è¡Œç¸½çµ
            const bestOutfitObj = topOutfits[0];
            if (bestOutfitObj) {
                const finalScore = bestOutfitObj.score;
                const finalTemp = T_outdoor + finalScore;

                // æ¨è–¦æ¨¡å¼ä¸‹ï¼Œè¨­ç½®å»ºè­°å¡ç‰‡çš„é€šç”¨å…§å®¹
                $actionAdviceCard.classList.add('bg-blue-100', 'border-blue-500'); // ç¢ºä¿åœ¨æ¨è–¦æ¨¡å¼ä¸‹é¡¯ç¤ºè—è‰²
                $actionAdviceText.innerHTML = `
                    **æ‚¨çš„æˆ¶å¤–èµ·å§‹æº«åº¦ (T_æˆ¶å¤–)ï¼š** **${T_outdoor.toFixed(1)}Â°C** (ç›®æ¨™ **${TARGET_TEMP.toFixed(1)}Â°C**)ã€‚<br>
                    **ç³»çµ±æ¨è–¦ç¸½é»æ•¸ (é¸é …ä¸€)ï¼š** **${finalScore.toFixed(1)}Â°C**ï¼Œé è¨ˆæœ€çµ‚é«”æ„Ÿå°‡é”åˆ° **${finalTemp.toFixed(1)}Â°C**ã€‚
                `;

                // é¡å¤–è™•ç†æ¨è–¦çµ„åˆçš„å¾®èª¿è¨Šæ¯ (éç†±æˆ–éå†·)
                const diffFromTarget = finalTemp - TARGET_TEMP;
                if (Math.abs(diffFromTarget) > 0.5) {
                    if (diffFromTarget > 0) {
                        // éç†±æé†’
                        $actionAdviceText.innerHTML += `<br><strong>âš ï¸ æ³¨æ„ï¼š</strong> æ¨è–¦ç¸½åˆ†é«˜å‡ºç›®æ¨™ **${diffFromTarget.toFixed(1)}Â°C**ï¼Œè«‹é ç•™è„«è¡£ç©ºé–“ã€‚`;
                    } else {
                        // éå†·æé†’
                        $actionAdviceText.innerHTML += `<br><strong>âš ï¸ æ³¨æ„ï¼š</strong> æ¨è–¦ç¸½åˆ†ä½æ–¼ç›®æ¨™ **${Math.abs(diffFromTarget).toFixed(1)}Â°C**ï¼Œå»ºè­°é¡å¤–æ·»åŠ åœå·¾æˆ–æ‰‹å¥—ç­‰é…ä»¶ã€‚`;
                    }
                }
            } else {
                // Should not happen if T_outdoor is valid
                $actionAdviceText.innerHTML = "æœªèƒ½æ‰¾åˆ°åˆé©çš„ç©¿æ­çµ„åˆã€‚è«‹æª¢æŸ¥è¼¸å…¥æº«åº¦ç¯„åœã€‚";
            }


            // è¿”å›åŸå§‹çš„ Set<string> æ ¼å¼
            return topOutfits.map(o => o.outfit);
        }

        /**
         * è™•ç†æ¨è–¦æŒ‰éˆ•é»æ“Šäº‹ä»¶ã€‚
         */
        function handleRecommendButtonClick() {
             // 1. æª¢æŸ¥æ˜¯å¦æœ‰è¶³å¤ çš„è¼¸å…¥ä¾†è¨ˆç®— T_æˆ¶å¤–
            const T_outdoor_sensible = $inputOutdoorTemp.value ? parseFloat($inputOutdoorTemp.value) : null;
            
            if (T_outdoor_sensible === null || isNaN(T_outdoor_sensible)) {
                alert("è«‹å…ˆè¼¸å…¥ç•¶å‰ç’°å¢ƒé«”æ„Ÿæº«åº¦ï¼Œæ‰èƒ½é€²è¡Œç©¿æ­æ¨è–¦ï¼");
                return;
            }

            // 2. é‡ç½®æ‰€æœ‰é¸é …çš„æ¨£å¼
            selectedItems.clear();
            document.querySelectorAll('#outfit-selector button').forEach(button => {
                button.classList.remove('bg-comfort-green', 'text-white', 'shadow-md');
                button.classList.add('bg-white', 'hover:bg-gray-50');
            });

            // 3. åŸ·è¡Œè¨ˆç®—ä¸¦å–å¾—æˆ¶å¤–é«”æ„Ÿæº«åº¦
            const T_outdoor = updateTemperatureCalibrator(false);
            const neededScore = TARGET_TEMP - T_outdoor;

            // 4. åŸ·è¡Œæ¨è–¦é‚è¼¯ (å–å¾—å¤šçµ„æ¨è–¦)
            const recommendedOutfits = recommendOutfit(neededScore, T_outdoor); // Now returns Array<Set<string>>

            // 5. è‡ªå‹•é¸ä¸­ã€ç¬¬ä¸€çµ„ã€‘æ¨è–¦çš„å–®å“ä¸¦æ›´æ–° UI
            if (recommendedOutfits.length > 0) {
                const recommended = recommendedOutfits[0]; // ä½¿ç”¨ç¬¬ä¸€å€‹æœ€ä½³é¸é …
                
                recommended.forEach(name => {
                    // æ’é™¤ 'ç„¡å…§è¡£' æˆ– 'ç„¡å¤–å¥—' çš„é¸é …
                    if (!name.startsWith('ç„¡')) {
                        selectedItems.add(name);
                        const button = document.querySelector(`button[data-name='${name}']`);
                        if (button) {
                            button.classList.add('bg-comfort-green', 'text-white', 'shadow-md');
                            button.classList.remove('bg-white', 'hover:bg-gray-50');
                        }
                    }
                });
            }

            // 6. æ¸²æŸ“æ¨è–¦æ¸…å–®åˆ°å°ˆå±¬å€å¡Š (é¡¯ç¤ºæ‰€æœ‰é¸é …)
            renderRecommendationList(recommendedOutfits);

            // 7. æ›´æ–°æ ¡æº–å„€èˆ‡çµæœ (è¨­ç½® isRecommendation ç‚º true, æ ¹æ“šé¸ä¸­çš„ç¬¬ä¸€çµ„)
            updateTemperatureCalibrator(true);
        }

        /**
         * è™•ç†ç©¿æ­å–®å“é¸æ“‡äº‹ä»¶ (ä½¿ç”¨è€…æ‰‹å‹•é»æ“Š)ã€‚
         */
        function handleItemClick(event) {
            const button = event.currentTarget;
            const itemName = button.dataset.name;

            // æ‰‹å‹•é»é¸æ™‚ï¼Œéš±è—è‡ªå‹•æ¨è–¦æ¸…å–®å’Œå»ºè­°å¡ç‰‡
            $finalRecommendationList.classList.add('hidden');
            $actionAdviceCard.classList.add('hidden'); // æ‰‹å‹•èª¿æ•´æ™‚éš±è—å»ºè­°å¡

            if (selectedItems.has(itemName)) {
                selectedItems.delete(itemName);
                button.classList.remove('bg-comfort-green', 'text-white', 'shadow-md');
                button.classList.add('bg-white', 'hover:bg-gray-50');
            } else {
                // é‡å°ã€Œå¤–å¥—ã€å’Œã€Œè¤²å­ã€åšå–®é¸é™åˆ¶
                const itemCategory = button.dataset.category;
                // æª¢æŸ¥æ˜¯å¦ç‚ºå–®é¸é¡åˆ¥
                if (itemCategory === 'å¤–å¥—' || itemCategory === 'è¤²å­') { 
                    OUTFIT_ITEMS.forEach(item => {
                        if (item.category === itemCategory && selectedItems.has(item.name)) {
                             selectedItems.delete(item.name);
                             // æ‰¾åˆ°ä¸¦é‡ç½®è¢«å–æ¶ˆçš„æŒ‰éˆ•æ¨£å¼
                             const oldBtn = document.querySelector(`button[data-name='${item.name}']`);
                             if(oldBtn) {
                                oldBtn.classList.remove('bg-comfort-green', 'text-white', 'shadow-md');
                                oldBtn.classList.add('bg-white', 'hover:bg-gray-50');
                             }
                        }
                    });
                }
                
                selectedItems.add(itemName);
                button.classList.add('bg-comfort-green', 'text-white', 'shadow-md');
                button.classList.remove('bg-white', 'hover:bg-gray-50');
            }

            // æ‰‹å‹•é»é¸æ™‚ï¼Œä¸ä½¿ç”¨æ¨è–¦æ¨¡å¼ï¼ŒadviceVisible ç‚º false
            updateTemperatureCalibrator(false);
        }

        /**
         * åˆå§‹åŒ–ç©¿æ­å–®å“é¸æ“‡å™¨ UIã€‚
         */
        function initializeSelectorUI() {
            // å®šç¾©é¡¯ç¤ºé †åºå’Œç¾¤çµ„
            const displayCategories = ['å¤–å¥—', 'ä¸Šè¡£', 'å…§è¡£', 'è¤²å­'];

            // æŒ‰ç…§åˆ†é¡åˆ†çµ„
            const categorizedItems = OUTFIT_ITEMS.reduce((acc, item) => {
                acc[item.category] = acc[item.category] || [];
                acc[item.category].push(item);
                return acc;
            }, {});

            // æ¸…ç©ºèˆŠçš„é¸æ“‡å™¨å…§å®¹
            $selector.innerHTML = ''; 

            // æ¸²æŸ“æ¯ä¸€å€‹é¡åˆ¥
            displayCategories.forEach(category => {
                const items = categorizedItems[category];
                if (items && items.length > 0) {
                    // ç‚ºäº†é¡¯ç¤ºæ›´è²¼è¿‘ä½¿ç”¨è€…ç”¨èªï¼Œå°‡ 'ä¸Šè¡£' é¡¯ç¤ºç‚º 'è¡£æœ'
                    const displayCategory = (category === 'ä¸Šè¡£' ? 'è¡£æœ' : category); 

                    const categoryTitle = document.createElement('h4');
                    // èª¿æ•´æ–‡å­—å¤§å°ä»¥é©æ‡‰æ‰‹æ©Ÿ
                    categoryTitle.className = "col-span-3 text-base sm:text-lg font-bold text-gray-700 mt-4 mb-2 border-b pb-1";
                    categoryTitle.textContent = displayCategory;
                    $selector.appendChild(categoryTitle);

                    items.forEach(item => {
                        const button = document.createElement('button');
                        // é‡å°æ‰‹æ©Ÿä½¿ç”¨ p-2 è¼ƒå°çš„å…§é‚Šè·ï¼Œæ¡Œé¢ä½¿ç”¨ sm:p-3
                        button.className = `card text-center transition duration-150 ease-in-out bg-white hover:bg-gray-50 p-2 sm:p-3 flex flex-col items-center justify-center h-full w-full break-words`;
                        button.dataset.name = item.name;
                        button.dataset.category = item.category;

                        button.innerHTML = `
                            <span class="text-lg sm:text-xl mb-1">${item.icon}</span>
                            <span class="text-xs sm:text-sm font-medium leading-tight w-full">${item.name}</span>
                            <span class="text-xs text-gray-400 mt-1">${item.score.toFixed(1)}Â°C</span>
                        `;
                        button.addEventListener('click', handleItemClick);
                        $selector.appendChild(button);
                    });
                }
            });
        }
        
        // --- åˆå§‹åŒ– APP ---
        window.onload = () => {
            initializeSelectorUI();
            $recommendButton.addEventListener('click', handleRecommendButtonClick);
            
            // åˆå§‹è¼‰å…¥æ™‚ï¼Œæ›´æ–°ä¸€æ¬¡ UI
            updateTemperatureCalibrator();
        };

        // ğŸš¨ ç°¡åŒ–çš„è‡ªå®šç¾© alert å‡½æ•¸ï¼Œå› ç‚ºä¸èƒ½ä½¿ç”¨ window.alert()
        function alert(message) {
            // åœ¨é€™è£¡å¯ä»¥å¯¦ä½œä¸€å€‹æ›´ç¾è§€çš„æ¨¡æ…‹æ¡† UI
            console.error("Alert:", message);
            // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘åªå°‡éŒ¯èª¤è¨Šæ¯é¡¯ç¤ºåœ¨çµæœç‹€æ…‹ä¸­
            $resultStatus.textContent = "â— éŒ¯èª¤";
            $resultMessage.textContent = message;
        }

    </script>
</body>
</html>